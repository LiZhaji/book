# 14章 表单

9.22-23

- 选中文本

- - select() 
  - getSelect()

- form的提交按钮可以有三种

- - input type = 'submit'
  - button type = 'submit' 不声明type默认为submit
  - input type = 'image'

- form的type类型非常多，如email/url /time/data/month/week /ranger/number...
- 剪切板事件

- - copy beforecopy
  - cut buforecut
  - paste beforepaste

- 富文本编辑器

- - 两种实现方法

- - - iframe + designmode = 'on' （onload时设置）+ body.innterHTML
    - div + contenteditable = 'true' + innerHTML

- - 样式转化

- - - document.execCommand(cmd, false, value) cmd el：backcolor/bold/createLink...
    - 文本选区信息

- - - - document.queryCommandEnabled(cmd) 对当前选择文本是否适用该命令
      - document.queryCommandValue(cmd) 就是设置时候的value
      - document.queryCommandState(cmd) 是否已经设置成功



# 15章 canvas

9.24

canvas上下文分为2D与3D（WebGL）

2D用来绘制图形，两种绘制方法： fill 填充、stroke 描边，所有的fill都为替换为stoke，下面只写一种方法了。

**canvas DOM对象方法/属性：**

- dataToURL() 转化为图像，得同源

  

**2D上下文方法/属性：**

- 绘图

  - 颜色 fillColor 
    - 渐变 createLLinerGradient(x, y, endX, endY) 返回一个渐变实例，实例的addColorStop(色标, 颜色) 添加渐变
    - 模式（重复）createPattern(omg/video/canvas, repeat-way)
  - 矩形 fillRect()
  - 路径 beginPath() /arc() /arcTo() /rect() lineTo() /moveTo() /closePath()（连接到起点）
  - 文字 fillText() font/textAlign/textBaseLine measureText('text')
  - 画图 drawImage()
  - 阴影 shadowColor /shadowOffsetX /shadowOffsetY /shadowBlur

- 变换

  - rotate() 旋转
  - translate(x, y) 移动坐标原点
  - scale() 缩放
  - transform()

- getImageData() /setImageData() 获取原始图像数据，返回imageData实例，实例上三个属性：width、height、[每个像素颜色值] rgba，即每4个数字表示一个像素。可以**实现滤镜。**

- globa lAlpha 全局透明度

- globalCompositeOperation 先后绘制图形的结合形式

  

**3D上下文**

WebGL基于OpenGL，类型化数组，着色器，纹理

# 20章 ajax

ajax = 异步 + xml ，最主要的特点就是能异步获取从而更新页面，使页面无需重新加载。

### xhr

其中最重要的一个概念xhr对象（xmlHttpRequest），原型链上有静态方法open、send、setRequestHeader等方法，readystate、timeout、responseText、state、withCredentials等属性

- open(method, url, ?async) 用于创建一个请求

- setRequestHeader(key, val)

- overrideMimeType(minetype) 重写响应的MIME类型

- send(?data) 发送请求

  事件

- loadstart

- process(open之前调用)

- error/abort/load(接收到完整的响应时)

- loaded(通信完成时或前三个回调之一完成后)

### 跨域

通源策略是xhr的主要约束。客户端与服务端的通信有跨域限制，非同源（协议域名端口号）两端无法交互。

- CORS（cross-origin resource sharing）跨域资源共享

xhr本身实现了cors能力，只要将url写为绝对路径即可。实际是通过自定义请求头决定，添加origin说明请求来源，服务端根据origin决定响应成功or失败

- 图像ping

  利用了图像无加载来源的限制。只允许get请求，单向通信，无法获取响应字符串

- JSONP（JSON with padding）参数式JSON

  利用了script标签无加载来源的限制。动态创建script标签，通过src规定url地址，将回调以callback参数形式附在地址上，有响应时就会触发该回调。

  ```js
  const test = (data) => {} // 定义回调
  const st = document.createElement("script")
  st.src='http://a.b.com?callback="test"'
  document.appendChild(st, document.body.lastChild) // 此处开始发送请求
  
  /* 
  Why ? 
  后端返回值为`test({"hi": "zhaji"})`
  script请求到的内容会自动执行，相当于执行了test函数。
  */
  ```

  从其他域中加载代码执行，无法保证安全。请求是否失败不容易判断。

- comet（理解为一种服务器向客户端推送数据的交互）

  - 长轮询。客户端发起一个请求，服务端保持连接打开，直到有数据可发送。发送完后关闭当前连接，再重新发起一个新的请求。短轮询是无论数据是否有效都立即发送，然后重新发送新的请求。
  - http流。客户端发起一个请求，服务端保持连接打开，周期性向浏览器发送数据。此时readystate会变为3，通过此状态拿到新的数据，并通过比较截取最新的数据。

- 服务端主动通信

  - SSE（server-sent event）服务器发送事件 ，理解为实现comet交互的api

    单向通信（只能接收服务端发来的消息，不能主动发送）

    支持短轮询、长轮询、http流

    - new EventSource(url)
    - open/message/error 

  - websocket

    使用websocket协议进行通信，支持双向通信，需要单独的web socket 服务器。
